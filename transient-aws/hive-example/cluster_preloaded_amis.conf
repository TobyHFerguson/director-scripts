
#
# Copyright (c) 2016 Cloudera, Inc. All rights reserved.
#

#
# Simple AWS Cloudera Director configuration file with automatic role assignments
# that works as expected if you use a single instance type for all cluster nodes
#

#
# Cluster name
#

name: ETL-Transient

#
# Cloud provider configuration (credentials, region or zone and optional default image)
#

provider {
    type: aws

    accessKeyId: "REPLACE_ME"
1"REPLACE_ME"

    publishAccessKeys: false

    region: us-east-1

    subnetId: subnet-fd0349b4 # toby-subnet-1

    securityGroupsIds: sg-6dd35e17 # tobys hadoop security group

    instanceNamePrefix: "toby-hive-cdh"

    associatePublicIpAddresses: true
}

#
# SSH credentials to use to connect to the instances
#

ssh {
    username: centos
    privateKey: """-----BEGIN RSA PRIVATE KEY-----
MIIEpAIBAAKCAQEAzPWKAcdpdBfhplc5lCyInJAJM81N2AdAFgwAxxXvS7X9Go8v
3aeenNV90jTbtjAHVzAhRD+RAujU+lyt+Ruos9XFyVpZKKtD1HngSmzfC7oceQdL
7l7TPFbZmT0mvyVDtAvkdUJarLueu9pykk+yjYPGE5dDnlo3aTMy58MXsNkZzpZ2
6xPlAuG1i/Z7xU4KzdIVuDUtndz6k+tx7bsVUkiEzsNZ7Kfqb1D3d1rpOgNISu5A
GWQEkJiz9+qlFc2XqPl3kI5WxM7bq/71cTSdulnWVnxZtAbXp3idqHVaQdr2L5FG
c+tyz/e8c0MD4XzwwZbYmACIWdkTkzK4fMZCoQIDAQABAoIBAQCQ1dK4fxpeF6I1
0d22f+HqAT7/hE1GI5l9+u1xwmZfsjMx2Y2RrSnA2n0XVpMMo9QMIM7hU6o9zBr0
8Rlft9P3gVFLgLUQsDY2qAl/jn/v4YzNWgKmaAwNz7HlP/lpigPV77F5y3IYLl11
kmD0U61xo3UN0w7NkCMoDC4k6RCMvxmfvGqKh5qpV98OdYa/VhqplyK9McNdtibQ
+GA33ZqhY+JiTG/eo2Lcmv3wVwvI7iJgtGWn2Y4A8UpcmIWjOtTnMOp0PDGnnsk7
xmzQ8g+aTJnC+JkmNAicTf83+lzau2bGNMLd5UwKGqd3YIcat5UGh902GwAxqZ8t
R1ff734hAoGBAPWL/NKFuN+M/Cy4fJ4r2AoNq7OX0PaCjbSy0eNw7BbFYnZpUfWz
39Y2T2LYmeFuxX7BJ6kw7Yke2OeIQcwl2XdrlLCsA0eDtVfd/j4XcpToG/VwA6rj
QqWULwfEHZKFppFFe6bnxjupXbg9V8rxmdnAijh9VJdCHWC0l2OEscoTAoGBANWv
OEDQcuqoKa2VaFMz203UtAB1+uA2uAJm1L2rvWyrEO42fGQHJY47DV+rEHlmXF7W
X+pgFk/Ims+WbRdm6Fy5XAMM1jQ/MhjzX0JX3NRwRGahHlvzUbZAn1s4iE8dOdM9
KF4KTyvVVEUd814cEmiaj3T/yJtddgAhkRaTepb7AoGBANk16oJ4lF/9IZ6V3Hc3
JbdO/JK0O7+1IZG1lgHyhIZoOX+yDzSg1+Nwy60PGqDXEpHcYC9E/vuLdCjs2fez
i7oeSrw2jfgXRLXjxOI8b7nV0dW+LyBeRTif6zKdg+N3oy9jHc05vpxMaIFwklcO
fiCoOB1ckRX1AHPpjPoWCghNAoGAEsfTqd6oOveMsjTvdmCYZb7MEz5LTmmAwrVG
/WSawXJHiqg/RotaQaXvBvmB+SmF9M/injbTvy9ia9xMukHRKlUgQSRfrzfer1K0
jKAsSH+Vg2+lu28nP11upBXT5SAsdORrJ9jAHJojTe/T8/GDrK3o7d+NQhp0xI4u
sk1D+QECgYAWWKw+yUxRO2D5NhYz6Ua3fwExPM59pN12d1Vj8ddfxNpyj0F8etHy
cmOcL9jOF0E07/oWFGdBqrM4w6SIqcVHx0Fw9I52gDxh+dEWWykaWVRBET10upre
VVV5tUmR389UZKBER3PmIvz3sSqlrrOva5u/Zjk7MQfs1NEzXC7zdw==
-----END RSA PRIVATE KEY-----"""
}

common-instance-properties {
    image: ami-49e9fe5e
    tags {
        owner: "toby"
    }
}
#
# A list of instance types to use for group of nodes or management services
#

instances {
    master : ${common-instance-properties} {
        type: c4.xlarge
        instanceNamePrefix: toby-master-cdh
    }
    worker : ${common-instance-properties} {
        type: r3.xlarge
        instanceNamePrefix: toby-worker-cdh 
    }

}


#
# Configuration for Cloudera Manager. Cloudera Director can use an existing instance
# or bootstrap everything from scratch for a new cluster
#

cloudera-manager {

    instance: ${instances.master} {
        tags {
            application: "Cloudera Manager 5"
        }
    }

   configs {
        # CLOUDERA_MANAGER corresponds to the Cloudera Manager Server configuration options

   	 CLOUDERA_MANAGER {
            custom_banner_html: "Managed by Cloudera Director"
            MANAGES_PARCELS: false
    	}
    }

    #
    # Automatically activate 60-Day Cloudera Enterprise Trial
    #
    enableEnterpriseTrial: true

    repository: "http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.9/"
    repositoryKeyUrl: "http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/RPM-GPG-KEY-cloudera"

}

#
# Cluster description
#

cluster {

    products {
      CDH: 5.9 # includes Hive and Spark
    }


    # S3 Configurations
    configs {
      HDFS {
        core_site_safety_valve: """
            <property>
                <name>fs.s3a.access.key</name>
                <value>REPLACE_ME</value>
            </property>
            <property>
                <name>fs.s3a.secret.key</name>
                <value>REPLACE_ME</value>
            </property>
            <property>
                <name>fs.s3a.block.size</name>
                <value>134217728</value>
            </property>
            <property>
              <name>fs.s3a.server-side-encryption-algorithm</name>
              <value>AES256</value>
            </property>
            <property>
              <name>fs.s3a.connection.ssl.enabled</name>
              <value>true</value>
              <description>Enables or disables SSL connections to S3.</description>
            </property>
        """
      }
    }

    parcelRepositories: ["http://archive.cloudera.com/cdh5/parcels/5.9/"]

    services: [HDFS, YARN, HIVE, SPARK_ON_YARN, OOZIE]

    masters {
      count: 1
      instance: ${instances.master}

      roles {
        HDFS: [NAMENODE, SECONDARYNAMENODE]
        YARN: [RESOURCEMANAGER, JOBHISTORY]
        HIVE: [HIVESERVER2, HIVEMETASTORE]
        OOZIE: [OOZIE_SERVER]
        SPARK_ON_YARN: [SPARK_YARN_HISTORY_SERVER]
      }
    }

    workers {
      count: 2

      instance: ${instances.worker}

      roles {
        HDFS: [DATANODE]
        YARN: [NODEMANAGER]
      }
    }

}
